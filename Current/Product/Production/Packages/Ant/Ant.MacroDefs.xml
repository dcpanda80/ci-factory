<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="Ant.MacroDefs">

  <macrodef name="ant">
    <attributes>
      <attribute name="antbat" default="${Ant.Bat}" type="string"/>
      <attribute name="logfile" type="string"/>
      <attribute name="target" type="string" require="true"/>
      <attribute name="buildfile" type="string" require="true"/>
    </attributes>
    <elementgroups>
      <elementgroup name="args" type="NAnt.Core.Types.Argument" elementname="arg"/>
    </elementgroups>
    <elements>
      <element name="environment" type="NAnt.Core.Types.EnvironmentSet"/>
    </elements>
    <sequential>
      <ifthenelse test="${property::exists('logfile')}">
        <then>
          <property name="Ant.LogParams" value='-logger com.agilex.ant.GoodXmlLogger -logfile "${logfile}"' overwrite="true"/>
          <ifnot test="${directory::exists(path::get-directory-name(logfile))}">
            <mkdir dir="${path::get-directory-name(logfile)}"/>
          </ifnot>
        </then>
        <else>
          <property name="Ant.LogParams" value='' overwrite="true"/>
        </else>
      </ifthenelse>

      <exec program="${antbat}" failonerror="true" verbose="true">
        <element name="environment"/>

        <arg line='${target} -buildfile "${buildfile}"' />
        <arg line='${Ant.LogParams}' />
        <arg line='-Dprogress-filepath="${CCNetListenerFile}"' />
        <arg line='-DProductVersion="${CCNetLabel}"' />
        <arg line='-Ddebug="${Ant.Debug}"' />

        <elementgroup name="args"/>
      </exec>
    </sequential>
  </macrodef>
  
</project>