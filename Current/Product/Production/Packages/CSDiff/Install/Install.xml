<?xml version="1.0" encoding="utf-8" ?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="CSDiff.Install" default="CSDiff.Install">

  <include buildfile="Properties.xml" />
  
  <target name="CSDiff.Install">
    <strings id="NAnt.Main.Targets">
      <string value="PostBuild"/>
    </strings>
    <largeproperty name="Packages.AddPostBuildActions.Block">
      <value xml="false">
        <![CDATA[<call target="CSDiff.GenerateHtmlReports" failonerror="false"/>]]>
      </value>
    </largeproperty>
    <call target="Packages.AddPostBuildActions"/>

    <largeproperty name="Packages.AddbuildPlugins.Block">
      <value xml="false" expand="true">
        <![CDATA[<artifactXslBuildPlugin 
        description="Diff" 
        actionName="DiffReports" 
        xslFileName="Packages\CSDiff\CSDiffReport.xsl" 
        artifactRootUrl="/&ProjectName;-&ProjectCodeLineName;/Artifacts" 
        xmlFileName="postbuildlog.xml" 
        imageFileName="Packages\CSDiff\Diff.gif" 
      >
        <excludedProjects>
          <projectName>&ProjectName;-&ProjectCodeLineName; Build Scripts</projectName>
        </excludedProjects>
      </artifactXslBuildPlugin>]]></value>
    </largeproperty>
    <call target="Packages.AddbuildPlugins"/>
  </target>

  <target name="CSDiff.SetAsCurrentPackage">
    <property name="Packages.CurrentPackage.PackageName" value="CSDiff"/>
    <property name="Current.BuildFile" value="${Common.Directory.Build.Path}\Post.Build.xml"/>
  </target>

  <target name="CSDiff.ValidateParameters">
    <fail unless="${stringlist::contains('Packages.InstallList', 'SourceModificationReport')}" message="Please inlcude the package SourceModificationReport.  The CSDiff package is dependent on it."/>
    <fail unless="${stringlist::contains('Packages.InstallList', 'Publish')}" message="Please inlcude the package Publish.  The CSDiff package is dependent on it."/>
  </target>
  
</project>