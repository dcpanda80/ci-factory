<?xml version="1.0" encoding="utf-8" ?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="Perforce.Installer.Properties">

	<property name="Perforce.ServerName" value="" overwrite="false"/>
	<property name="Perforce.ServerPort" value="1666" overwrite="false"/>
	<property name="Perforce.ServerPathPrefix" value="//depot" overwrite="false"/>
  <property name="Perforce.WorkspaceNameBase" value="${ProjectName}-${ProjectCodeLineName}" overwrite="false"/>
  <property name="Perforce.WorkspaceName" value="${Perforce.WorkspaceNameBase}-${environment::get-machine-name()}" overwrite="false"/>

  <largeproperty name="SourceControl.MainBuildBlock">
    <value xml="false" expand="true">
      <![CDATA[<sourcecontrol type="filtered">
      <sourceControlProvider  
        type="vstsbyFileSpecSourceControl" 
        applyLabel="true" 
        autoGetSource="false"
        port="${Perforce.Listener.Port}"
        statefilepath="${BuildDirectory}\server\${ProjectName}.Perforce.state.xml"
        project="$/${ProjectName}/${ProjectCodeLineName}"
        server="${Perforce.ServerUrl}"
        workspace="${Perforce.WorkspaceNameBase}-{0}"
        />
      <exclusionFilters>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Product/**/AssemblyInfo.*</pattern>
        </pathFilter>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Product/ProjectInfo.*</pattern>
        </pathFilter>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Product/**/ProjectInfo.*</pattern>
        </pathFilter>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Build/*.*</pattern>
        </pathFilter>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Build/**/*.*</pattern>
        </pathFilter>
        <pathFilter>
          <pattern>$/${ProjectName}/${ProjectCodeLineName}/Product/**/~*</pattern>
        </pathFilter>
      </exclusionFilters>
    </sourcecontrol>]]></value>
  </largeproperty>

  <largeproperty name="SourceControl.BuildUpdateBlock">
    <value xml="false" expand="true">
      <![CDATA[<sourcecontrol  
      type="vstsbyFileSpecSourceControl" 
      applyLabel="false" 
      autoGetSource="true"
      port="${Perforce.BuildScripts.Listener.Port}"
      statefilepath="${BuildDirectory}\server\${ProjectName}BuildScripts.Perforce.state.xml"
      project="$/${ProjectName}/${ProjectCodeLineName}/Build"
      server="${Perforce.ServerUrl}"
      workingDirectory="${BuildDirectory}"
      workspace="${Perforce.WorkspaceNameBase}-{0}"
      />]]></value>
  </largeproperty>

	<function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.ServerName%', Perforce.ServerName)}"/>
	<function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.ServerPort%', Perforce.ServerPort)}"/>
	<function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.ServerPathPrefix%', Perforce.ServerPathPrefix)}"/>
  <function execute="${filterchain::replacestring-add('Common.FilterChain', '%SourceControl.BuildUpdateBlock%', SourceControl.BuildUpdateBlock)}"/>
  <function execute="${filterchain::replacestring-add('Common.FilterChain', '%SourceControl.MainBuildBlock%', SourceControl.MainBuildBlock)}"/>
  <function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.ServerUrl%', Perforce.ServerUrl)}"/>
  <function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.WorkspaceNameBase%', Perforce.WorkspaceNameBase)}"/>
  <function execute="${filterchain::replacestring-add('Common.FilterChain', '%Perforce.ServerConnection%', Perforce.ServerConnection)}"/>

</project>