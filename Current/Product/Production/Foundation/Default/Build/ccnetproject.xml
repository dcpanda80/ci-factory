<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE cruisecontrol [
  <!ENTITY % entities SYSTEM "Entities.xml">

  %entities;
  
  <!ENTITY email '<email from="&ProjectName;-&ProjectCodeLineName;.Build@noreply.com" mailhost="&EmailHost;" includeDetails="true" dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
        <users>
          <user name="%BuildMaster.Name%" group="buildmaster" address="%BuildMaster.Email%"/>
          %Developer.List%
        </users>
        <groups>
          <group name="buildmaster" notification="failed"/>
        </groups>
      </email>'>
  <!ENTITY labeller '<labeller type="defaultlabeller">
      <prefix>&LabelPrefix;</prefix>
    </labeller>'>
  <!ENTITY DeployBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Deploy">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY DeployFailed '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Deploy">
            <exclusionFilters>
              <conditions>
                <condition>Failure</condition>
              </conditions>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY DevBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Dev">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY DevFailed '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Dev">
            <exclusionFilters>
              <conditions>
                <condition>Failure</condition>
              </conditions>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY HeavyBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Heavy">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY ReleaseBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Release">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY TestBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName;-Test">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
  <!ENTITY ScriptsBuilding '<projectFilter
               serverUri="&CCNet.Server.Remoting.Url;"
               project="&ProjectName;-&ProjectCodeLineName; Build Scripts">
            <exclusionFilters>
              <activities>
                <activity>Building</activity>
              </activities>
            </exclusionFilters>
          </projectFilter>'>
]>
<cruisecontrol port="&Port;" restUri="http://&HostName;:&RestPort;">
  <project name="&ProjectName;-&ProjectCodeLineName; Build Scripts">
    <webURL>&CCNet.Dashboard.Url;</webURL>
    <state type="state" />
    <triggers>
      <projectTriggerFilter>
        <trigger type="intervalTrigger" seconds="%CCNET.IntervalTrigger%" />
        <projectFilters>
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectTriggerFilter>
    </triggers>
    <forceFilters>
      <projectForceFilter>
        <projectFilters>
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectForceFilter>
      <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
    </forceFilters>
    <integrationFilter>
      <triggeredIntegrationFilter>
        <allowed>
          <modificationsRequired condition="true" />
        </allowed>
      </triggeredIntegrationFilter>
    </integrationFilter>
    <modificationDelaySeconds>%CCNET.ModificationDelaySeconds%</modificationDelaySeconds>
    %SourceControl.BuildUpdateBlock%
  <labeller type="defaultlabeller">
		<prefix>BuildScripts.</prefix>
	</labeller>
  <tasks>
    <nullTask/>
  </tasks>
  <publishers>
    <xmllogger />
    &email;
  </publishers>
</project>
  <project name="&ProjectName;-&ProjectCodeLineName;-Dev">
  <webURL>&CCNet.Dashboard.Url;</webURL>
  <state type="state" />
  <triggers>
    <projectTriggerFilter>
      <trigger type="intervalTrigger" seconds="%CCNET.IntervalTrigger%" />
      <projectFilters>
        &ScriptsBuilding;
        &ReleaseBuilding;
        &HeavyBuilding;
        &TestBuilding;
        &DeployBuilding;
      </projectFilters>
    </projectTriggerFilter>
  </triggers>
  <forceFilters>
    <projectForceFilter>
      <projectFilters>
        &ScriptsBuilding;
        &ReleaseBuilding;
        &HeavyBuilding;
        &TestBuilding;
        &DeployBuilding;
      </projectFilters>
    </projectForceFilter>
    <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
  </forceFilters>
  <integrationFilter>
    <triggeredIntegrationFilter>
      <allowed>
        <modificationsRequired condition="true" />
      </allowed>
    </triggeredIntegrationFilter>
    <forcedIntegrationFilter>
      <allowed>
        <modificationsRequired condition="false" />
      </allowed>
      <blocked>
      </blocked>
    </forcedIntegrationFilter>
  </integrationFilter>
  <modificationDelaySeconds>%CCNET.ModificationDelaySeconds%</modificationDelaySeconds>
  %SourceControl.MainBuildBlock%
  &labeller;
  <tasks>
    <modificationWriter>
        <filename>SourceModificationReport.xml</filename>
      <path>&Common.Directory.Build.Path;\SourceModificationReports\&ProjectName;-&ProjectCodeLineName;-Dev</path>
      </modificationWriter>
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Main.build.xml</buildFile>
        <buildArgs>-listener:NAnt.Core.AppendListener</buildArgs>
        <targetList>
          <target>Triggered</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </tasks>
    <publishers>
      <merge>
        <files>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Dev\Reports\*.xml</file>
        </files>
      </merge>
      <xslmerger dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
        <filepairs>
        </filepairs>
      </xslmerger>
      <xmllogger />
      &email;
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Post.Shim.xml</buildFile>
        <targetList>
          <target>PostBuildWrapper</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </publishers>
  </project>
  <project name="&ProjectName;-&ProjectCodeLineName;-Heavy">
    <webURL>&CCNet.Dashboard.Url;</webURL>
    <state type="state" />
    <triggers>
      <projectTriggerFilter>
        <trigger type="scheduleTrigger" time="12:30" buildCondition="IfModificationExists" />
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectTriggerFilter>
    </triggers>
    <forceFilters>
      <projectForceFilter>
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectForceFilter>
      <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
    </forceFilters>
    <integrationFilter>
      <triggeredIntegrationFilter>
        <allowed>
          <modificationsRequired condition="true" />
        </allowed>
      </triggeredIntegrationFilter>
      <forcedIntegrationFilter>
        <allowed>
          <modificationsRequired condition="false" />
        </allowed>
        <blocked>
        </blocked>
      </forcedIntegrationFilter>
    </integrationFilter>
    <modificationDelaySeconds>%CCNET.ModificationDelaySeconds%</modificationDelaySeconds>
    %SourceControl.ReleaseBuildBlock%
    <labeller type="stateFileLabeller">
      <project>&ProjectName;-&ProjectCodeLineName;-Dev</project>
    </labeller>
    <tasks>
      <modificationWriter>
        <filename>SourceModificationReport.xml</filename>
        <path>&Common.Directory.Build.Path;\SourceModificationReports\&ProjectName;-&ProjectCodeLineName;-Heavy</path>
      </modificationWriter>
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Main.build.xml</buildFile>
        <buildArgs>-listener:NAnt.Core.AppendListener</buildArgs>
        <targetList>
          <target>Heavy</target>
        </targetList>

        <buildTimeoutSeconds>600</buildTimeoutSeconds>
      </nant>
    </tasks>
    <publishers>
      <merge>
        <files>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Heavy\Reports\*.xml</file>
        </files>
      </merge>
      <xslmerger dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
      </xslmerger>
      <xmllogger />
      &email;
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Post.Shim.xml</buildFile>
        <targetList>
          <target>PostBuildWrapper</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </publishers>
  </project>
  <project name="&ProjectName;-&ProjectCodeLineName;-Release">
    <webURL>&CCNet.Dashboard.Url;</webURL>
    <state type="state" />
    <triggers>
      <projectTriggerFilter>
        <trigger type="scheduleTrigger" time="23:30" buildCondition="IfModificationExists" />
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &HeavyBuilding;
          &DevFailed;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectTriggerFilter>
    </triggers>
    <forceFilters>
      <projectForceFilter>
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &HeavyBuilding;
          &DevFailed;
          &TestBuilding;
          &DeployBuilding;
        </projectFilters>
      </projectForceFilter>
      <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
    </forceFilters>
    <integrationFilter>
      <triggeredIntegrationFilter>
        <allowed>
          <modificationsRequired condition="true" />
        </allowed>
      </triggeredIntegrationFilter>
      <forcedIntegrationFilter>
        <allowed>
          <modificationsRequired condition="false" />
        </allowed>
        <blocked>
        </blocked>
      </forcedIntegrationFilter>
    </integrationFilter>
    <modificationDelaySeconds>%CCNET.ModificationDelaySeconds%</modificationDelaySeconds>
    %SourceControl.ReleaseBuildBlock%
    <labeller type="stateFileLabeller">
      <project>&ProjectName;-&ProjectCodeLineName;-Dev</project>
    </labeller>
    <tasks>
      <modificationWriter>
        <filename>SourceModificationReport.xml</filename>
        <path>&Common.Directory.Build.Path;\SourceModificationReports\&ProjectName;-&ProjectCodeLineName;-Release</path>
      </modificationWriter>
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Main.build.xml</buildFile>
        <buildArgs>-listener:NAnt.Core.AppendListener</buildArgs>
        <targetList>
          <target>Release</target>
        </targetList>

        <buildTimeoutSeconds>4000</buildTimeoutSeconds>
      </nant>
    </tasks>
    <publishers>
      <merge>
        <files>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\Reports\*.xml</file>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\AntLogs\*.xml</file>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\TargetProcess\*.xml</file>
        </files>
      </merge>
      <xslmerger dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
        <filepairs>
          <filepair>
            <xslfile>&Common.Directory.Packages.Path;\JUnit\JUnitSummary.xsl</xslfile>
            <xmlfile>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\UnitTestReports\*.xml</xmlfile>
          </filepair>
          <filepair>
            <xslfile>&Common.Directory.Packages.Path;\IntegrationTest\JUnitSummary.xsl</xslfile>
            <xmlfile>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\IntegrationTestReports\*.xml</xmlfile>
          </filepair>
          <filepair>
            <xslfile>&Common.Directory.Packages.Path;\Selenium\SeleniumSummary.xsl</xslfile>
            <xmlfile>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\WebTestReports\*.xml</xmlfile>
          </filepair>
          <filepair>
            <xslfile>&Common.Directory.Packages.Path;\Simian\SimianSummary.xsl</xslfile>
            <xmlfile>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Release\SimianReport\SimianReport.xml</xmlfile>
          </filepair>
          <filepair>
            <xslfile>&Common.Directory.Packages.Path;\Corbertura\CoverageSummary.xsl</xslfile>
            <xmlfile>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Dev\Coverage\CoverageReport.xml</xmlfile>
          </filepair>
        </filepairs>
      </xslmerger>
      <xmllogger />
      &email;
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Post.Shim.xml</buildFile>
        <targetList>
          <target>PostBuildWrapper</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </publishers>
  </project>
  <project name="&ProjectName;-&ProjectCodeLineName;-Test">
    <webURL>&CCNet.Dashboard.Url;</webURL>
    <state type="state" />
    <triggers>
      <projectTriggerFilter>
        <trigger type="multipleTriggers">
          <triggers>
            <intervalTrigger seconds="60" />
            <projectTrigger
              serverUri="tcp://&HostName;:&CCNet.Server.Remoting.Port;/CruiseManager.rem"
              project="&ProjectName;-&ProjectCodeLineName;-Deploy"
            >
              <triggerStatus>Success</triggerStatus>
              <innerTrigger type="intervalTrigger" seconds="30" buildCondition="ForceBuild"/>
            </projectTrigger>
          </triggers>
        </trigger>
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &DeployBuilding;
          &DeployFailed;
        </projectFilters>
      </projectTriggerFilter>
    </triggers>
    <forceFilters>
      <projectForceFilter>
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &DeployBuilding;
          &DeployFailed;
        </projectFilters>
      </projectForceFilter>
      <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
    </forceFilters>
    <integrationFilter>
      <triggeredIntegrationFilter>
        <allowed>
          <modificationsRequired condition="true" />
        </allowed>
      </triggeredIntegrationFilter>
      <forcedIntegrationFilter>
        <allowed>
          <modificationsRequired condition="false" />
        </allowed>
        <blocked>
        </blocked>
      </forcedIntegrationFilter>
    </integrationFilter>
    <modificationDelaySeconds>%CCNET.ModificationDelaySeconds%</modificationDelaySeconds>
    %SourceControl.TestBuildBlock%
    <labeller type="stateFileLabeller">
      <project>&ProjectName;-&ProjectCodeLineName;-Release</project>
    </labeller>
    <tasks>
      <modificationWriter>
        <filename>SourceModificationReport.xml</filename>
        <path>&Common.Directory.Build.Path;\SourceModificationReports\&ProjectName;-&ProjectCodeLineName;-Test</path>
      </modificationWriter>
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Main.build.xml</buildFile>
        <buildArgs>-listener:NAnt.Core.AppendListener</buildArgs>
        <targetList>
          <target>Test</target>
        </targetList>

        <buildTimeoutSeconds>600</buildTimeoutSeconds>
      </nant>
    </tasks>
    <publishers>
      <merge>
        <files>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Test\Reports\*.xml</file>
        </files>
      </merge>
      <xslmerger dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
      </xslmerger>
      <xmllogger />
      &email;
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Post.Shim.xml</buildFile>
        <targetList>
          <target>PostBuildWrapper</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </publishers>
  </project>
  <project name="&ProjectName;-&ProjectCodeLineName;-Deploy">
    <webURL>&CCNet.Dashboard.Url;</webURL>
    <state type="state" />
    <triggers>
      <projectTriggerFilter name="Project">
        <trigger
          type="projectTrigger"
          serverUri="tcp://&HostName;:&CCNet.Server.Remoting.Port;/CruiseManager.rem"
          project="&ProjectName;-&ProjectCodeLineName;-Release"
        >
          <triggerStatus>Success</triggerStatus>
          <innerTrigger type="intervalTrigger" seconds="30" buildCondition="ForceBuild"/>
        </trigger>
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &TestBuilding;
        </projectFilters>
      </projectTriggerFilter>
    </triggers>
    <forceFilters>
      <projectForceFilter name="Force">
        <projectFilters>
          &ScriptsBuilding;
          &DevBuilding;
          &ReleaseBuilding;
          &HeavyBuilding;
          &TestBuilding;
        </projectFilters>
      </projectForceFilter>
      <!--<userForceFilter dontCheck="true" domainName="localhost" userName="crap" password="junk"/>-->
    </forceFilters>
    <integrationFilter>
      <triggeredIntegrationFilter>
        <allowed>
          <modificationsRequired condition="false" />
        </allowed>
      </triggeredIntegrationFilter>
      <forcedIntegrationFilter>
        <allowed>
          <modificationsRequired condition="false" />
        </allowed>
        <blocked>
        </blocked>
      </forcedIntegrationFilter>
    </integrationFilter>
    <sourcecontrol type="nullSourceControl" />
    <labeller type="stateFileLabeller">
      <project>&ProjectName;-&ProjectCodeLineName;-Release</project>
    </labeller>
    <tasks>
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Main.build.xml</buildFile>
        <buildArgs>-listener:NAnt.Core.AppendListener</buildArgs>
        <targetList>
          <target>Deploy</target>
        </targetList>

        <buildTimeoutSeconds>600</buildTimeoutSeconds>
      </nant>
    </tasks>
    <publishers>
      <merge>
        <files>
          <file>&Common.Directory.Transient.Path;\&ProjectName;-&ProjectCodeLineName;-Deploy\Reports\*.xml</file>
        </files>
      </merge>
      <xslmerger dashboardServerName="&ProjectName;-&ProjectCodeLineName;">
      </xslmerger>
      <xmllogger />
      &email;
      <nant>
        <executable>&Tools.NAnt.Exe;</executable>
        <baseDirectory>&Common.Directory.Build.Path;</baseDirectory>
        <logger>NAnt.Core.XmlLogger </logger>
        <buildFile>Post.Shim.xml</buildFile>
        <targetList>
          <target>PostBuildWrapper</target>
        </targetList>

        <buildTimeoutSeconds>300</buildTimeoutSeconds>
      </nant>
    </publishers>
  </project>
</cruisecontrol>
